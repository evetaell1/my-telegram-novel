{"parameters":{"plugins":[],"text_panel":{"size":["95%","27%"],"position":[],"color":"rgba(242,242,242,0.7)","style":"border-radius:16px;backdrop-filter:blur(12px);border-top:2px solid rgba(255,255,255,.7);border-bottom:2px solid rgba(0,0,0,.15);box-shadow: 0px 4px 14px rgba(0,0,0,.15);","color_text":"#000","indent_text":"8px 16px","indent_bottom":"3.5%","dialog_speed":"10","show_all_text":true,"art":{"ru":""}},"name_panel":{"style":"border-radius:16px;border-top:1px solid rgba(255,255,255,.5);border-bottom:1px solid rgba(0,0,0,.2);box-shadow: 0px 4px 14px rgba(0,0,0,.15);","size":["","32px"],"position":["0","0","-42px","0"],"indent_text":"0 16px","color_text":"#fff","align":["start","center"],"color":"#555","art":{"ru":""}},"title":"DreamoraGames","launch_story":"main_menu","key":{},"languares":["ru"],"buttons":[{"name":"tue_back","position":["2.5%",0,0,"32px"],"size":["25%","25%"],"color_text":"#000","text":"<","hotspot":["0%","0%"],"align":["start","end"],"indent_text":"8px 14px","art":{"ru":""},"sound":{"ru":""}},{"name":"tue_next","position":[0,"2.5%",0,"32px"],"size":["25%","25%"],"color_text":"#000","text":">","hotspot":["0%","0%"],"align":["end","end"],"indent_text":"8px 14px","art":{"ru":""},"sound":{"ru":""}}],"autosave":false,"font":"Arial","font_size":"18px","variables":{},"characters":{},"style_file":"","icon":"","font_files":{},"sounds":{}},"blocks":{"main_menu":["711.13px","135.39px","block","#cfffd8"]},"main_menu":[{"dialogs":[{"js":"// 1. Очистка старого лобби (если есть), чтобы не дублировать\nlet oldLobby = document.getElementById('dreamora_lobby');\nif (oldLobby) oldLobby.remove();\n\n// 2. Создаем контейнер-оверлей\nlet lobby = document.createElement('div');\nlobby.id = 'dreamora_lobby';\n// Стили: черный фон, на весь экран, поверх всего (z-index: 9999)\nlobby.style = \"position:fixed; top:0; left:0; width:100%; height:100%; background:#1a1a1a; z-index:9999; overflow-y:auto; color:white; font-family:sans-serif; padding:20px; box-sizing:border-box;\";\n\n// 3. Данные твоих новелл (убедись, что пути к картинкам и файлам верные!)\nwindow.myNovels = [\n    {\n        id: \"elina_robot\",\n        title: \"Протокол Элина\",\n        desc: \"Цифровое сознание в теле робота...\",\n        genre: \"Sci-Fi\",\n        img: \"images/preview/elina.jpg\",\n        file: \"stories/elina/ep1.json\" // Всегда Ep 1 для новичков\n    },\n    {\n        id: \"elevator_story\",\n        title: \"Застрявшие\",\n        desc: \"Марк и Артур застряли в лифте...\",\n        genre: \"Драма / Триллер\",\n        img: \"images/preview/elevator.jpg\",\n        file: \"stories/elevator/ep1.json\"\n    }\n];\n\nwindow.launchNovel = function(novelId, storyFile) {\n    console.log(\"Инициализация протокола для файла:\", storyFile);\n    \n    // Скрываем наше меню\n    const lobby = document.getElementById('dreamora_lobby');\n    if (lobby) lobby.style.display = 'none';\n\n    try {\n        // 1. ПРАВИЛЬНЫЙ ВЫЗОВ: добавляем флаг \"file\"\n        load_story(\"file\", storyFile);\n        \n        // 2. Ждем, пока движок закончит чтение JSON\n        // Tuesday.js сам отправит событие 'script_loaded', когда всё будет готово\n        tuesday.addEventListener('script_loaded', function once() {\n            console.log(\"Скрипт \" + novelId + \" полностью загружен в ОЗУ.\");\n            \n            // Теперь вызываем переход в стартовый блок из твоего ep1.json\n            setTimeout(() => {\n                if (typeof scene_go === 'function') {\n                    scene_go(\"ep1_start\");\n                } else {\n                    go_to(\"ep1_start\");\n                }\n            }, 100);\n\n            // Удаляем слушатель, чтобы он не срабатывал при загрузке других глав\n            tuesday.removeEventListener('script_loaded', once);\n        });\n\n    } catch (e) {\n        console.error(\"Критический сбой загрузчика:\", e);\n    }\n};\n\n// 5. Генерация таблицы (Grid)\nlet gridHTML = `<h1 style=\"text-align:center; color:#00d4ff;\">Dreamora Games</h1>`;\ngridHTML += `<div style=\"display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:30px; margin-top:30px;\">`;\n\nwindow.myNovels.forEach(novel => {\n    gridHTML += `\n        <div class=\"novel-card\" onclick=\"launchNovel('${novel.id}', '${novel.file}')\" style=\"cursor:pointer; text-align:center;\">\n            <img src=\"${novel.img}\" style=\"width:100%; border-radius:15px; border:2px solid #333; transition:0.3s;\" \n                 onmouseover=\"this.style.borderColor='#00d4ff'\" onmouseout=\"this.style.borderColor='#333'\">\n            <div style=\"font-size:1.4em; font-weight:bold; margin:10px 0;\">${novel.title}</div>\n            <div style=\"font-size:0.9em; color:#aaa; height:40px; overflow:hidden;\">${novel.desc}</div>\n            <div style=\"font-size:0.8em; color:#00d4ff; margin-top:5px; text-transform:uppercase;\">${novel.genre}</div>\n        </div>\n    `;\n});\n\ngridHTML += `</div>`;\nlobby.innerHTML = gridHTML;\n\n// 6. Добавляем на страницу\ndocument.body.appendChild(lobby);"}],"background_color":"#ffffff"}]}